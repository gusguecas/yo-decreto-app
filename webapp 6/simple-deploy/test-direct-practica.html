<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Directo Mi Práctica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
</head>
<body class="bg-slate-900 text-white p-8">
    <h1 class="text-2xl mb-4">Test Directo Mi Práctica</h1>
    <div id="resultado" class="mb-4"></div>
    <div id="main-content"></div>

    <script>
        // Configuración global
        const APP_CONFIG = {
            apiBase: '/api',
            defaultSection: 'decretos'
        }

        // API Client básico
        const API = {
            async request(endpoint, options = {}) {
                const url = `${APP_CONFIG.apiBase}${endpoint}`
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    ...options
                }

                try {
                    console.log('🔄 API Request:', url, config)
                    const response = await axios(url, config)
                    console.log('✅ API Response:', response.data)
                    return response.data
                } catch (error) {
                    console.error('❌ API Error:', error)
                    throw error
                }
            },

            practica: {
                getRutinas: () => API.request('/practica/rutinas'),
                getAfirmaciones: (params) => API.request('/practica/afirmaciones', { params }),
                getProgresoDia: (fecha) => API.request(`/practica/rutinas/progreso-dia/${fecha || ''}`)
            }
        }

        // UI básico
        const UI = {
            renderLoading(mensaje) {
                return `<div class="text-center text-blue-400">${mensaje}</div>`
            }
        }

        // Test directo
        async function testPractica() {
            console.log('🧪 Iniciando test directo de Práctica...')
            const resultado = document.getElementById('resultado')
            const mainContent = document.getElementById('main-content')

            try {
                resultado.innerHTML = '✅ Iniciando test...'
                mainContent.innerHTML = UI.renderLoading('Cargando práctica...')
                
                console.log('🔄 Cargando rutinas...')
                resultado.innerHTML = '🔄 Cargando rutinas...'
                const rutinas = await API.practica.getRutinas()
                console.log('✅ Rutinas:', rutinas)
                
                console.log('🔄 Cargando afirmaciones...')
                resultado.innerHTML = '🔄 Cargando afirmaciones...'
                const afirmaciones = await API.practica.getAfirmaciones()
                console.log('✅ Afirmaciones:', afirmaciones)
                
                console.log('🔄 Cargando progreso del día...')
                resultado.innerHTML = '🔄 Cargando progreso del día...'
                const progreso = await API.practica.getProgresoDia()
                console.log('✅ Progreso:', progreso)
                
                resultado.innerHTML = '✅ ¡Todas las APIs funcionan correctamente!'
                mainContent.innerHTML = `
                    <div class="bg-green-800 p-4 rounded">
                        <h2 class="text-xl mb-2">✅ Test Exitoso</h2>
                        <p>Rutinas: ${rutinas.data.length}</p>
                        <p>Afirmaciones: ${afirmaciones.data.length}</p>
                        <p>Progreso: ${progreso.data.porcentaje_progreso}%</p>
                    </div>
                `
                
            } catch (error) {
                console.error('❌ Error en test:', error)
                resultado.innerHTML = `❌ Error: ${error.message}`
                mainContent.innerHTML = `
                    <div class="bg-red-800 p-4 rounded">
                        <h2 class="text-xl mb-2">❌ Test Falló</h2>
                        <p>${error.message}</p>
                        <pre class="text-xs mt-2">${error.stack || JSON.stringify(error, null, 2)}</pre>
                    </div>
                `
            }
        }

        // Ejecutar test automáticamente
        window.addEventListener('load', () => {
            console.log('🎯 Página cargada, ejecutando test...')
            setTimeout(testPractica, 1000)
        })
    </script>
</body>
</html>